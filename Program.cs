using Microsoft.AspNetCore.Localization;
using Microsoft.Extensions.Options;
using System.Globalization;
using System.Linq;
using System.Net.Http;

var builder = WebApplication.CreateBuilder(args);

// ? ???????? ?? ???????? ?? ????????????
builder.Services.AddLocalization(options => options.ResourcesPath = "Resources");

// ? ????????? ???????
var supportedCultures = new[] { "mk", "en", "sr" };
var defaultCulture = "en";  // ??????? ?? ??????

// ? ????????????? ?? RequestLocalizationOptions
builder.Services.Configure<RequestLocalizationOptions>(options =>
{
    options.DefaultRequestCulture = new RequestCulture(defaultCulture);
    options.SupportedCultures = supportedCultures.Select(c => new CultureInfo(c)).ToList();
    options.SupportedUICultures = supportedCultures.Select(c => new CultureInfo(c)).ToList();

    // ????????? ?????? ?? ?????????? ?? RequestCultureProviders
    options.RequestCultureProviders.Clear(); // ????????? ?? ???????????
    options.RequestCultureProviders.Add(new CookieRequestCultureProvider()); // ????????? CookieRequestCultureProvider
});

builder.Services.AddRazorPages();
builder.Services.AddServerSideBlazor();
builder.Services.AddScoped<HttpClient>(sp =>
    new HttpClient { BaseAddress = new Uri("http://localhost:5098") });

var app = builder.Build();

// ? Middleware ?? ????????????
var localizationOptions = app.Services.GetRequiredService<IOptions<RequestLocalizationOptions>>().Value;
app.UseRequestLocalization(localizationOptions);

// ? ???????? ??????? ? ????????
app.UseStaticFiles();
app.UseRouting();

// ? ???????? ?? ?????????? (??? ???? API ?????????? ??? ??????? ?? ????)
app.MapControllers();

// ? ???????? ?? Blazor Hub
app.MapBlazorHub();


// ? ?????? ?? Blazor ??????????
app.MapFallbackToPage("/_Host");

// ? ?????????? ?? ????????????
app.Run();

